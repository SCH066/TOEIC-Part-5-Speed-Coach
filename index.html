<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOEIC Part 5 Speed Coach - V1.3 é‚è¼¯å¼·åŒ–ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --apple-blue: #0071E3;
            --apple-green: #34C759;
            --apple-orange: #FF9500;
            --apple-red: #FF3B30;
            --apple-gray-bg: #F5F5F7;
            --apple-gray-border: #E5E5EA;
            --apple-text: #1D1D1F;
            --apple-text-secondary: #86868B;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--apple-gray-bg);
            color: var(--apple-text);
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .onboarding-hero {
            background: linear-gradient(135deg, var(--apple-blue), #0051BA);
            color: white;
            padding: 60px 20px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 40px;
        }

        .onboarding-hero h1 {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--apple-text-secondary);
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--apple-gray-border);
            border-radius: 12px;
            font-size: 16px;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--apple-blue);
            box-shadow: 0 0 0 3px rgba(0, 113, 227, 0.1);
        }

        .bento-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 16px;
            margin-bottom: 40px;
        }

        .bento-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04), 0 4px 20px rgba(0, 0, 0, 0.06);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .bento-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08), 0 8px 32px rgba(0, 0, 0, 0.12);
            transform: translateY(-2px);
        }

        .bento-card-large {
            grid-column: span 12;
        }

        .bento-card-medium {
            grid-column: span 6;
        }

        .bento-card-small {
            grid-column: span 4;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 999px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: var(--apple-blue);
            color: white;
        }

        .btn-primary:hover {
            background: #0077ED;
            transform: scale(1.02);
        }

        .btn-primary:active {
            transform: scale(0.98);
            background: #0066D6;
        }

        .btn-secondary {
            background: var(--apple-gray-bg);
            color: var(--apple-text);
        }

        .btn-secondary:hover {
            background: #E5E5EA;
        }

        .quiz-question {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 30px;
            text-align: center;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option-btn {
            padding: 16px;
            border: 2px solid var(--apple-gray-border);
            border-radius: 12px;
            background: white;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 16px;
        }

        .option-btn:hover {
            border-color: var(--apple-blue);
            background: rgba(0, 113, 227, 0.05);
        }

        .option-btn.selected {
            border-color: var(--apple-blue);
            background: rgba(0, 113, 227, 0.1);
        }

        .option-btn.correct {
            border-color: var(--apple-green);
            background: rgba(52, 199, 89, 0.1);
        }

        .option-btn.incorrect {
            border-color: var(--apple-red);
            background: rgba(255, 59, 48, 0.1);
        }

        .feedback-box {
            margin-top: 20px;
            padding: 16px;
            border-radius: 12px;
            display: none;
        }

        .feedback-box.show {
            display: block;
        }

        .feedback-correct {
            background: rgba(52, 199, 89, 0.1);
            border-left: 4px solid var(--apple-green);
        }

        .feedback-incorrect {
            background: rgba(255, 59, 48, 0.1);
            border-left: 4px solid var(--apple-red);
        }

        .feedback-slow {
            background: rgba(255, 149, 0, 0.1);
            border-left: 4px solid var(--apple-orange);
        }

        .analysis-section {
            margin-top: 16px;
            padding: 12px;
            background: white;
            border-radius: 8px;
            font-size: 14px;
        }

        .analysis-item {
            margin-bottom: 12px;
            padding: 8px;
            background: var(--apple-gray-bg);
            border-radius: 6px;
        }

        .flip-card {
            background-color: #f1f1f1;
            width: 200px;
            height: 250px;
            perspective: 1000px;
            cursor: pointer;
            margin: 10px;
            display: inline-block;
        }

        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .flip-card.flipped .flip-card-inner {
            transform: rotateY(180deg);
        }

        .flip-card-front, .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            padding: 16px;
        }

        .flip-card-front {
            background-color: var(--apple-blue);
            color: white;
            font-size: 18px;
            font-weight: 600;
        }

        .flip-card-back {
            background-color: var(--apple-green);
            color: white;
            transform: rotateY(180deg);
            font-size: 14px;
            flex-direction: column;
            justify-content: center;
        }

        .tag {
            display: inline-block;
            background: var(--apple-blue);
            color: white;
            padding: 4px 12px;
            border-radius: 999px;
            font-size: 12px;
            margin-right: 8px;
            margin-bottom: 8px;
        }

        .tag-filter {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }

        .tag-filter button {
            padding: 8px 16px;
            border: 1px solid var(--apple-gray-border);
            border-radius: 999px;
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .tag-filter button.active {
            background: var(--apple-blue);
            color: white;
            border-color: var(--apple-blue);
        }

        @media (max-width: 768px) {
            .bento-card-medium,
            .bento-card-small {
                grid-column: span 12;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Onboarding Page -->
        <div id="onboardingPage" class="page active">
            <div class="onboarding-hero">
                <h1>ğŸš€ TOEIC Part 5 Speed Coach</h1>
                <p>ç§‘å­¸åŒ–è¨“ç·´ï¼Œå¿«é€Ÿæå‡ç­”é¡Œé€Ÿåº¦èˆ‡æ­£ç¢ºç‡</p>
            </div>
            <div class="bento-grid">
                <div class="bento-card bento-card-large">
                    <div class="form-group">
                        <label>æ‚¨çš„ç›®æ¨™åˆ†æ•¸</label>
                        <input type="number" id="targetScore" placeholder="ä¾‹å¦‚ï¼š900">
                    </div>
                    <div class="form-group">
                        <label>æœ€è¿‘ä¸€æ¬¡æˆç¸¾</label>
                        <input type="number" id="recentScore" placeholder="ä¾‹å¦‚ï¼š750">
                    </div>
                    <div class="form-group">
                        <label>ä¸»è¦å¼±é»é ˜åŸŸ</label>
                        <select id="weaknessFocus">
                            <option value="Tense">æ™‚æ…‹ (Tense)</option>
                            <option value="Preposition">ä»‹ç³»è© (Preposition)</option>
                            <option value="Conjunction">é€£æ¥è© (Conjunction)</option>
                            <option value="PartOfSpeech">è©æ€§ (Part of Speech)</option>
                            <option value="Vocabulary">å­—å½™ (Vocabulary)</option>
                            <option value="All">ä»¥ä¸Šçš†æ˜¯ (All of the above)</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" id="startLearningBtn">é–‹å§‹å­¸ç¿’</button>
                </div>
            </div>
        </div>

        <!-- Dashboard Page -->
        <div id="dashboardPage" class="page">
            <div class="bento-grid">
                <div class="bento-card bento-card-large" style="background: linear-gradient(135deg, var(--apple-blue), #0051BA); color: white;">
                    <h2 id="dashboardGreeting">æ­¡è¿å›ä¾†ï¼</h2>
                    <p id="dashboardStats" style="margin-top: 10px; opacity: 0.9;"></p>
                </div>

                <div class="bento-card bento-card-small">
                    <div style="text-align: center;">
                        <div style="font-size: 28px; font-weight: 700; color: var(--apple-blue);" id="avgSpeed">-</div>
                        <div style="font-size: 12px; color: var(--apple-text-secondary);">å¹³å‡é€Ÿåº¦ (ç§’)</div>
                    </div>
                </div>

                <div class="bento-card bento-card-small">
                    <div style="text-align: center;">
                        <div style="font-size: 28px; font-weight: 700; color: var(--apple-green);" id="correctRate">-</div>
                        <div style="font-size: 12px; color: var(--apple-text-secondary);">æ­£ç¢ºç‡</div>
                    </div>
                </div>

                <div class="bento-card bento-card-small">
                    <div style="text-align: center;">
                        <div style="font-size: 28px; font-weight: 700; color: var(--apple-orange);" id="completedQuizzes">0</div>
                        <div style="font-size: 12px; color: var(--apple-text-secondary);">å·²å®Œæˆæ¸¬é©—</div>
                    </div>
                </div>

                <div class="bento-card bento-card-small">
                    <div style="text-align: center;">
                        <div style="font-size: 28px; font-weight: 700; color: var(--apple-red);" id="mistakeCount">0</div>
                        <div style="font-size: 12px; color: var(--apple-text-secondary);">éŒ¯é¡Œæ•¸</div>
                    </div>
                </div>

                <div class="bento-card bento-card-small">
                    <div style="text-align: center;">
                        <div style="font-size: 28px; font-weight: 700; color: var(--apple-blue);" id="vocabCount">0</div>
                        <div style="font-size: 12px; color: var(--apple-text-secondary);">æ”¶è—å–®å­—</div>
                    </div>
                </div>

                <div class="bento-card bento-card-medium">
                    <button class="btn btn-primary" id="startQuizBtn" style="width: 100%;">â–¶ é–‹å§‹æ¸¬é©—</button>
                </div>

                <div class="bento-card bento-card-medium">
                    <button class="btn btn-secondary" id="viewMistakesBtn" style="width: 100%;">ğŸ“– éŒ¯é¡Œæœ¬</button>
                </div>

                <div class="bento-card bento-card-medium">
                    <button class="btn btn-secondary" id="viewVocabBtn" style="width: 100%;">ğŸ“Œ å–®å­—åº«</button>
                </div>

                <div class="bento-card bento-card-medium">
                    <button class="btn btn-secondary" id="settingsBtn" style="width: 100%;">âš™ï¸ è¨­å®š</button>
                </div>
            </div>
        </div>

        <!-- Quiz Page -->
        <div id="quizPage" class="page">
            <div class="bento-grid">
                <div class="bento-card bento-card-large">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <span id="quizProgress">ç¬¬ 1 / 10 é¡Œ</span>
                        <div style="margin-top: 10px; font-size: 12px; color: var(--apple-text-secondary);">
                            <span id="quizTimer">0</span>ç§’
                        </div>
                    </div>

                    <div class="quiz-question" id="questionText">Loading...</div>

                    <div class="quiz-options" id="optionsContainer"></div>

                    <div class="feedback-box" id="feedbackBox">
                        <div id="feedbackText"></div>
                        <div class="analysis-section" id="analysisBox"></div>
                    </div>

                    <div style="margin-top: 20px; display: flex; gap: 10px;">
                        <button class="btn btn-primary" id="saveWordBtn" style="flex: 1; display: none;">ğŸ“Œ æ”¶è—å–®å­—</button>
                        <button class="btn btn-primary" id="nextQuestionBtn" style="flex: 1; display: none;">ä¸‹ä¸€é¡Œ</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quiz Results Page -->
        <div id="resultsPage" class="page">
            <div class="bento-grid">
                <div class="bento-card bento-card-large" style="background: linear-gradient(135deg, var(--apple-green), #2ECC71); color: white; text-align: center;">
                    <h2>å®Œæˆæ¸¬é©—ï¼</h2>
                    <div style="font-size: 48px; font-weight: 700; margin: 20px 0;" id="finalScore">0/10</div>
                    <div style="font-size: 18px; margin-bottom: 20px;">
                        å¹³å‡æ™‚é–“ï¼š<span id="finalAvgTime">0</span> ç§’ | æ­£ç¢ºç‡ï¼š<span id="finalAccuracy">0%</span>
                    </div>
                    <button class="btn btn-primary" id="backToDashboardBtn" style="background: white; color: var(--apple-green);">è¿”å›é¦–é </button>
                </div>
            </div>
        </div>

        <!-- Mistake Book Page -->
        <div id="mistakeBookPage" class="page">
            <div class="bento-grid">
                <div class="bento-card bento-card-large">
                    <h2>ğŸ“– éŒ¯é¡Œæœ¬</h2>
                    <div class="tag-filter" id="tagFilter"></div>
                    <div id="mistakeBookContainer"></div>
                    <button class="btn btn-secondary" id="backFromMistakesBtn" style="width: 100%; margin-top: 20px;">è¿”å›</button>
                </div>
            </div>
        </div>

        <!-- Word Bank Page -->
        <div id="wordBankPage" class="page">
            <div class="bento-grid">
                <div class="bento-card bento-card-large">
                    <h2>ğŸ“Œ å–®å­—åº« (Flip Cards)</h2>
                    <div id="wordBankContainer" style="display: flex; flex-wrap: wrap; justify-content: center;"></div>
                    <button class="btn btn-secondary" id="backFromVocabBtn" style="width: 100%; margin-top: 20px;">è¿”å›</button>
                </div>
            </div>
        </div>

        <!-- Settings Page -->
        <div id="settingsPage" class="page">
            <div class="bento-grid">
                <div class="bento-card bento-card-large">
                    <h2>âš™ï¸ è¨­å®š</h2>
                    <h3 style="margin-top: 20px; margin-bottom: 10px;">è³‡æ–™ç®¡ç†</h3>
                    <button class="btn btn-secondary" id="exportCSVBtn" style="width: 100%; margin-bottom: 10px;">ğŸ“¥ åŒ¯å‡ºè³‡æ–™ (CSV)</button>
                    <button class="btn btn-secondary" id="exportJSONBtn" style="width: 100%; margin-bottom: 10px;">ğŸ“¥ åŒ¯å‡ºè³‡æ–™ (JSON)</button>
                    <button class="btn btn-secondary" id="importJSONBtn" style="width: 100%; margin-bottom: 10px;">ğŸ“¤ åŒ¯å…¥è³‡æ–™ (JSON)</button>
                    <input type="file" id="importFile" accept=".json" style="display: none;">
                    <button class="btn btn-secondary" id="resetBtn" style="width: 100%; background: var(--apple-red); color: white;">ğŸ”„ é‡ç½®æ‰€æœ‰è³‡æ–™</button>
                    <button class="btn btn-secondary" id="backFromSettingsBtn" style="width: 100%; margin-top: 20px;">è¿”å›</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== ç¿»è­¯å°ç…§è¡¨ =====
        const tagTranslations = {
            'Tense': 'æ™‚æ…‹',
            'Preposition': 'ä»‹ç³»è©',
            'Conjunction': 'é€£æ¥è©',
            'PartOfSpeech': 'è©æ€§',
            'Vocabulary': 'å­—å½™',
            'All': 'å…¨æ–¹ä½'
        };

        // ===== é¡Œåº«è³‡æ–™ (30 é¡Œ) =====
        const questionsDatabase = [
            {
                id: 1,
                text: "She ____ the project before the deadline.",
                options: ["complete", "completes", "completed", "will complete"],
                correctIndex: 3,
                tags: ["Tense", "Future_Simple"],
                analysis: {
                    A: "complete - å‹•è©åŸå½¢ï¼Œä¸ç¬¦åˆå¥å­æ™‚æ…‹éœ€æ±‚",
                    B: "completes - ç¬¬ä¸‰äººç¨±å–®æ•¸ç¾åœ¨å¼ï¼Œä½†å¥å­è¡¨é”æœªä¾†å‹•ä½œ",
                    C: "completed - éå»å¼ï¼Œä¸ç¬¦åˆ 'before the deadline' çš„æœªä¾†å«ç¾©",
                    D: "will complete - æ­£ç¢ºã€‚æœªä¾†ç°¡å–®å¼ï¼Œè¡¨ç¤ºå°‡ä¾†æœƒå®Œæˆçš„å‹•ä½œ"
                }
            },
            {
                id: 2,
                text: "The meeting is scheduled ____ 3 PM tomorrow.",
                options: ["at", "on", "in", "for"],
                correctIndex: 0,
                tags: ["Preposition", "Time"],
                analysis: {
                    A: "at - æ­£ç¢ºã€‚ç”¨æ–¼è¡¨ç¤ºå…·é«”æ™‚é–“é»",
                    B: "on - ç”¨æ–¼æ—¥æœŸæˆ–æ˜ŸæœŸï¼Œä¸ç”¨æ–¼æ™‚é–“é»",
                    C: "in - ç”¨æ–¼æœˆä»½ã€å­£ç¯€æˆ–æ™‚é–“æ®µ",
                    D: "for - è¡¨ç¤ºæ™‚é–“æ®µçš„é•·åº¦"
                }
            },
            {
                id: 3,
                text: "Although she was tired, ____ she completed the report.",
                options: ["but", "however", "yet", "still"],
                correctIndex: 2,
                tags: ["Conjunction", "Contrast"],
                analysis: {
                    A: "but - ä¸èƒ½èˆ‡ 'although' åŒæ™‚ä½¿ç”¨",
                    B: "however - æ˜¯å‰¯è©ï¼Œéœ€è¦åˆ†è™Ÿæˆ–å¥è™Ÿ",
                    C: "yet - æ­£ç¢ºã€‚å¯èˆ‡ 'although' æ­é…è¡¨ç¤ºå°æ¯”",
                    D: "still - å‰¯è©ï¼Œä¸é©åˆæ­¤å¥å‹"
                }
            },
            {
                id: 4,
                text: "The company ____ its employees to work from home.",
                options: ["allow", "allows", "allowed", "allowing"],
                correctIndex: 1,
                tags: ["Tense", "Present_Simple"],
                analysis: {
                    A: "allow - å‹•è©åŸå½¢ï¼Œä½†ä¸»è©æ˜¯ç¬¬ä¸‰äººç¨±å–®æ•¸",
                    B: "allows - æ­£ç¢ºã€‚ç¬¬ä¸‰äººç¨±å–®æ•¸ç¾åœ¨å¼",
                    C: "allowed - éå»å¼ï¼Œä¸ç¬¦åˆç¾åœ¨æƒ…å¢ƒ",
                    D: "allowing - ç¾åœ¨åˆ†è©ï¼Œä¸é©åˆæ­¤å¥å‹"
                }
            },
            {
                id: 5,
                text: "The report must be submitted ____ Friday.",
                options: ["by", "until", "before", "till"],
                correctIndex: 0,
                tags: ["Preposition", "Deadline"],
                analysis: {
                    A: "by - æ­£ç¢ºã€‚è¡¨ç¤ºæˆªæ­¢æ—¥æœŸ",
                    B: "until - è¡¨ç¤ºæŒçºŒåˆ°æŸæ™‚é–“é»",
                    C: "before - è¡¨ç¤ºåœ¨...ä¹‹å‰ï¼Œä½†è¼ƒä¸æ­£å¼",
                    D: "till - éæ­£å¼ç”¨æ³•"
                }
            },
            {
                id: 6,
                text: "I haven't seen him ____ last month.",
                options: ["since", "for", "during", "within"],
                correctIndex: 0,
                tags: ["Preposition", "Time_Period"],
                analysis: {
                    A: "since - æ­£ç¢ºã€‚ç”¨æ–¼ç¾åœ¨å®Œæˆå¼ï¼Œè¡¨ç¤ºå¾æŸæ™‚é–“é»é–‹å§‹",
                    B: "for - ç”¨æ–¼æ™‚é–“æ®µé•·åº¦ï¼Œä¸ç”¨æ–¼æ™‚é–“é»",
                    C: "during - è¡¨ç¤ºæœŸé–“å…§",
                    D: "within - è¡¨ç¤ºåœ¨...ä¹‹å…§"
                }
            },
            {
                id: 7,
                text: "The employees ____ working on the new project for three weeks.",
                options: ["have been", "has been", "are", "is"],
                correctIndex: 0,
                tags: ["Tense", "Present_Perfect_Continuous"],
                analysis: {
                    A: "have been - æ­£ç¢ºã€‚è¤‡æ•¸ä¸»è© + ç¾åœ¨å®Œæˆé€²è¡Œå¼",
                    B: "has been - ç”¨æ–¼ç¬¬ä¸‰äººç¨±å–®æ•¸",
                    C: "are - ç¾åœ¨é€²è¡Œå¼ï¼Œä¸ç¬¦åˆ 'for three weeks'",
                    D: "is - ç¬¬ä¸‰äººç¨±å–®æ•¸ï¼Œä¸ç¬¦åˆè¤‡æ•¸ä¸»è©"
                }
            },
            {
                id: 8,
                text: "The manager asked us to ____ the deadline.",
                options: ["extend", "extends", "extended", "extending"],
                correctIndex: 0,
                tags: ["PartOfSpeech", "Verb"],
                analysis: {
                    A: "extend - æ­£ç¢ºã€‚å‹•è©åŸå½¢ï¼Œç”¨æ–¼ 'ask to' çµæ§‹",
                    B: "extends - ç¬¬ä¸‰äººç¨±å–®æ•¸ï¼Œä¸ç¬¦åˆæ­¤çµæ§‹",
                    C: "extended - éå»å¼ï¼Œä¸ç¬¦åˆæ­¤çµæ§‹",
                    D: "extending - ç¾åœ¨åˆ†è©ï¼Œä¸ç¬¦åˆæ­¤çµæ§‹"
                }
            },
            {
                id: 9,
                text: "The new software is ____ to use than the old one.",
                options: ["easy", "easier", "easiest", "more easy"],
                correctIndex: 1,
                tags: ["PartOfSpeech", "Adjective_Comparative"],
                analysis: {
                    A: "easy - åŸç´šï¼Œä¸ç¬¦åˆæ¯”è¼ƒ",
                    B: "easier - æ­£ç¢ºã€‚å–®éŸ³ç¯€å½¢å®¹è©çš„æ¯”è¼ƒç´š",
                    C: "easiest - æœ€é«˜ç´šï¼Œä¸ç¬¦åˆæ­¤å¥å‹",
                    D: "more easy - ä¸æ­£ç¢ºï¼Œæ‡‰ç”¨ 'easier'"
                }
            },
            {
                id: 10,
                text: "We need to discuss the proposal ____ the team.",
                options: ["with", "to", "for", "among"],
                correctIndex: 0,
                tags: ["Preposition", "Collaboration"],
                analysis: {
                    A: "with - æ­£ç¢ºã€‚è¡¨ç¤ºèˆ‡...ä¸€èµ·è¨è«–",
                    B: "to - ä¸é©åˆæ­¤å¥å‹",
                    C: "for - è¡¨ç¤ºç‚ºäº†...ï¼Œä¸ç¬¦åˆæ­¤æ„",
                    D: "among - è¡¨ç¤ºåœ¨...ä¹‹ä¸­ï¼Œä½†é€šå¸¸ç”¨æ–¼å¤šæ–¼å…©å€‹"
                }
            },
            {
                id: 11,
                text: "If I ____ about the meeting, I would have attended.",
                options: ["knew", "had known", "know", "would know"],
                correctIndex: 1,
                tags: ["Tense", "Past_Perfect"],
                analysis: {
                    A: "knew - ç¬¬äºŒæ¢ä»¶å¥ï¼Œä¸ç¬¦åˆæ­¤çµæ§‹",
                    B: "had known - æ­£ç¢ºã€‚ç¬¬ä¸‰æ¢ä»¶å¥ï¼Œè¡¨ç¤ºéå»çš„å‡è¨­",
                    C: "know - ç¾åœ¨å¼ï¼Œä¸ç¬¦åˆæ­¤çµæ§‹",
                    D: "would know - æ¢ä»¶å¥ï¼Œä½†æ™‚æ…‹ä¸å°"
                }
            },
            {
                id: 12,
                text: "The document should be ____ to the client immediately.",
                options: ["send", "sent", "sending", "sends"],
                correctIndex: 1,
                tags: ["Tense", "Passive_Voice"],
                analysis: {
                    A: "send - å‹•è©åŸå½¢ï¼Œä¸ç¬¦åˆè¢«å‹•èªæ…‹",
                    B: "sent - æ­£ç¢ºã€‚è¢«å‹•èªæ…‹éå»åˆ†è©",
                    C: "sending - ç¾åœ¨åˆ†è©ï¼Œä¸ç¬¦åˆè¢«å‹•èªæ…‹",
                    D: "sends - ç¾åœ¨å¼ï¼Œä¸ç¬¦åˆè¢«å‹•èªæ…‹"
                }
            },
            {
                id: 13,
                text: "The presentation was so ____ that everyone fell asleep.",
                options: ["bored", "boring", "bores", "bore"],
                correctIndex: 1,
                tags: ["PartOfSpeech", "Adjective"],
                analysis: {
                    A: "bored - è¡¨ç¤ºäººæ„Ÿåˆ°ç„¡èŠï¼Œä¸ç¬¦åˆæ­¤å¥æ„",
                    B: "boring - æ­£ç¢ºã€‚è¡¨ç¤ºäº‹ç‰©ä»¤äººç„¡èŠ",
                    C: "bores - å‹•è©ï¼Œä¸ç¬¦åˆæ­¤å¥å‹",
                    D: "bore - å‹•è©åŸå½¢ï¼Œä¸ç¬¦åˆæ­¤å¥å‹"
                }
            },
            {
                id: 14,
                text: "We have been waiting ____ the bus for an hour.",
                options: ["to", "for", "at", "on"],
                correctIndex: 1,
                tags: ["Preposition", "Duration"],
                analysis: {
                    A: "to - ä¸é©åˆæ­¤å¥å‹",
                    B: "for - æ­£ç¢ºã€‚è¡¨ç¤ºæ™‚é–“æ®µé•·åº¦",
                    C: "at - è¡¨ç¤ºä½ç½®æˆ–æ™‚é–“é»",
                    D: "on - ä¸é©åˆæ­¤å¥å‹"
                }
            },
            {
                id: 15,
                text: "The CEO ____ the company for over 20 years.",
                options: ["leads", "lead", "has led", "is leading"],
                correctIndex: 2,
                tags: ["Tense", "Present_Perfect"],
                analysis: {
                    A: "leads - ç¾åœ¨å¼ï¼Œä¸ç¬¦åˆ 'for over 20 years'",
                    B: "lead - å‹•è©åŸå½¢ï¼Œä¸ç¬¦åˆæ­¤å¥å‹",
                    C: "has led - æ­£ç¢ºã€‚ç¾åœ¨å®Œæˆå¼ï¼Œè¡¨ç¤ºå¾éå»æŒçºŒåˆ°ç¾åœ¨",
                    D: "is leading - ç¾åœ¨é€²è¡Œå¼ï¼Œä¸ç¬¦åˆæ­¤æ„"
                }
            },
            {
                id: 16,
                text: "All employees must comply ____ the new regulations.",
                options: ["to", "with", "for", "at"],
                correctIndex: 1,
                tags: ["Preposition", "Compliance"],
                analysis: {
                    A: "to - ä¸ç¬¦åˆ 'comply' çš„æ­é…",
                    B: "with - æ­£ç¢ºã€‚'comply with' æ˜¯å›ºå®šæ­é…",
                    C: "for - ä¸ç¬¦åˆæ­¤å¥å‹",
                    D: "at - ä¸ç¬¦åˆæ­¤å¥å‹"
                }
            },
            {
                id: 17,
                text: "The package will arrive ____ next week.",
                options: ["in", "on", "at", "by"],
                correctIndex: 3,
                tags: ["Preposition", "Time"],
                analysis: {
                    A: "in - ç”¨æ–¼æœˆä»½æˆ–æ™‚é–“æ®µ",
                    B: "on - ç”¨æ–¼å…·é«”æ—¥æœŸ",
                    C: "at - ç”¨æ–¼å…·é«”æ™‚é–“é»",
                    D: "by - æ­£ç¢ºã€‚è¡¨ç¤ºä¸é²æ–¼æŸæ™‚é–“"
                }
            },
            {
                id: 18,
                text: "Neither the manager ____ the assistant was available.",
                options: ["nor", "or", "and", "but"],
                correctIndex: 0,
                tags: ["Conjunction", "Negation"],
                analysis: {
                    A: "nor - æ­£ç¢ºã€‚'neither...nor' æ˜¯å›ºå®šæ­é…",
                    B: "or - ç”¨æ–¼è‚¯å®šå¥",
                    C: "and - ä¸ç¬¦åˆæ­¤å¥å‹",
                    D: "but - è¡¨ç¤ºå°æ¯”ï¼Œä¸ç¬¦åˆæ­¤å¥å‹"
                }
            },
            {
                id: 19,
                text: "The training program ____ to improve employee skills.",
                options: ["design", "designs", "is designed", "designed"],
                correctIndex: 2,
                tags: ["Tense", "Passive_Voice"],
                analysis: {
                    A: "design - å‹•è©åŸå½¢ï¼Œä¸ç¬¦åˆè¢«å‹•èªæ…‹",
                    B: "designs - ç¾åœ¨å¼ï¼Œä¸ç¬¦åˆè¢«å‹•èªæ…‹",
                    C: "is designed - æ­£ç¢ºã€‚è¢«å‹•èªæ…‹ç¾åœ¨å¼",
                    D: "designed - éå»åˆ†è©ï¼Œç¼ºå°‘åŠ©å‹•è©"
                }
            },
            {
                id: 20,
                text: "The contract was signed ____ both parties.",
                options: ["by", "with", "from", "to"],
                correctIndex: 0,
                tags: ["Preposition", "Agency"],
                analysis: {
                    A: "by - æ­£ç¢ºã€‚è¢«å‹•èªæ…‹ä¸­è¡¨ç¤ºå‹•ä½œåŸ·è¡Œè€…",
                    B: "with - ä¸ç¬¦åˆè¢«å‹•èªæ…‹çµæ§‹",
                    C: "from - ä¸ç¬¦åˆæ­¤å¥å‹",
                    D: "to - ä¸ç¬¦åˆæ­¤å¥å‹"
                }
            },
            {
                id: 21,
                text: "I ____ my keys somewhere in the office.",
                options: ["must lose", "must have lost", "must be losing", "must lose"],
                correctIndex: 1,
                tags: ["Tense", "Modal_Perfect"],
                analysis: {
                    A: "must lose - ç¾åœ¨å¼ï¼Œä¸ç¬¦åˆæ­¤æ¨æ¸¬",
                    B: "must have lost - æ­£ç¢ºã€‚è¡¨ç¤ºå°éå»äº‹ä»¶çš„æ¨æ¸¬",
                    C: "must be losing - ç¾åœ¨é€²è¡Œå¼ï¼Œä¸ç¬¦åˆæ­¤æ„",
                    D: "must lose - é‡è¤‡é¸é …"
                }
            },
            {
                id: 22,
                text: "The new policy will take effect ____ January 1st.",
                options: ["in", "on", "at", "from"],
                correctIndex: 1,
                tags: ["Preposition", "Date"],
                analysis: {
                    A: "in - ç”¨æ–¼æœˆä»½",
                    B: "on - æ­£ç¢ºã€‚ç”¨æ–¼å…·é«”æ—¥æœŸ",
                    C: "at - ç”¨æ–¼æ™‚é–“é»",
                    D: "from - è¡¨ç¤ºèµ·é»"
                }
            },
            {
                id: 23,
                text: "The company ____ its headquarters to a new location.",
                options: ["relocate", "relocates", "has relocated", "is relocating"],
                correctIndex: 2,
                tags: ["Tense", "Present_Perfect"],
                analysis: {
                    A: "relocate - å‹•è©åŸå½¢ï¼Œä¸ç¬¦åˆæ­¤å¥å‹",
                    B: "relocates - ç¾åœ¨å¼ï¼Œä½†å¥å­æš—ç¤ºå·²å®Œæˆ",
                    C: "has relocated - æ­£ç¢ºã€‚ç¾åœ¨å®Œæˆå¼",
                    D: "is relocating - ç¾åœ¨é€²è¡Œå¼ï¼Œå¯èƒ½ä¹Ÿç¬¦åˆï¼Œä½† 'has relocated' æ›´å¼·èª¿å®Œæˆ"
                }
            },
            {
                id: 24,
                text: "The project was completed ____ schedule.",
                options: ["on", "in", "at", "by"],
                correctIndex: 0,
                tags: ["Preposition", "Schedule"],
                analysis: {
                    A: "on - æ­£ç¢ºã€‚'on schedule' æ˜¯å›ºå®šæ­é…",
                    B: "in - ä¸ç¬¦åˆæ­¤æ­é…",
                    C: "at - ä¸ç¬¦åˆæ­¤æ­é…",
                    D: "by - è¡¨ç¤ºä¸é²æ–¼"
                }
            },
            {
                id: 25,
                text: "Either the sales team ____ the marketing team will present.",
                options: ["or", "nor", "and", "but"],
                correctIndex: 0,
                tags: ["Conjunction", "Choice"],
                analysis: {
                    A: "or - æ­£ç¢ºã€‚'either...or' æ˜¯å›ºå®šæ­é…",
                    B: "nor - ç”¨æ–¼å¦å®š",
                    C: "and - è¡¨ç¤ºä¸¦åˆ—",
                    D: "but - è¡¨ç¤ºå°æ¯”"
                }
            },
            {
                id: 26,
                text: "The report should be submitted ____ the end of the month.",
                options: ["by", "until", "before", "on"],
                correctIndex: 0,
                tags: ["Preposition", "Deadline"],
                analysis: {
                    A: "by - æ­£ç¢ºã€‚è¡¨ç¤ºæˆªæ­¢æ—¥æœŸ",
                    B: "until - è¡¨ç¤ºæŒçºŒåˆ°æŸæ™‚é–“",
                    C: "before - å¯ç”¨ï¼Œä½† 'by' æ›´å¸¸è¦‹",
                    D: "on - è¡¨ç¤ºå…·é«”æ—¥æœŸ"
                }
            },
            {
                id: 27,
                text: "The employees have been ____ for a salary increase.",
                options: ["asking", "asked", "ask", "asks"],
                correctIndex: 0,
                tags: ["Tense", "Present_Perfect_Continuous"],
                analysis: {
                    A: "asking - æ­£ç¢ºã€‚ç¾åœ¨å®Œæˆé€²è¡Œå¼",
                    B: "asked - éå»åˆ†è©ï¼Œä¸ç¬¦åˆæ­¤çµæ§‹",
                    C: "ask - å‹•è©åŸå½¢ï¼Œä¸ç¬¦åˆæ­¤çµæ§‹",
                    D: "asks - ç¾åœ¨å¼ï¼Œä¸ç¬¦åˆæ­¤çµæ§‹"
                }
            },
            {
                id: 28,
                text: "The meeting was postponed ____ next week.",
                options: ["to", "until", "for", "in"],
                correctIndex: 0,
                tags: ["Preposition", "Time"],
                analysis: {
                    A: "to - æ­£ç¢ºã€‚è¡¨ç¤ºå»¶æœŸåˆ°æŸæ™‚é–“",
                    B: "until - è¡¨ç¤ºæŒçºŒåˆ°æŸæ™‚é–“",
                    C: "for - è¡¨ç¤ºæ™‚é–“æ®µé•·åº¦",
                    D: "in - ç”¨æ–¼æœˆä»½æˆ–æ™‚é–“æ®µ"
                }
            },
            {
                id: 29,
                text: "The new software ____ to be user-friendly.",
                options: ["design", "designs", "is designed", "designed"],
                correctIndex: 2,
                tags: ["Tense", "Passive_Voice"],
                analysis: {
                    A: "design - å‹•è©åŸå½¢ï¼Œä¸ç¬¦åˆè¢«å‹•èªæ…‹",
                    B: "designs - ç¾åœ¨å¼ï¼Œä¸ç¬¦åˆè¢«å‹•èªæ…‹",
                    C: "is designed - æ­£ç¢ºã€‚è¢«å‹•èªæ…‹ç¾åœ¨å¼",
                    D: "designed - éå»åˆ†è©ï¼Œç¼ºå°‘åŠ©å‹•è©"
                }
            },
            {
                id: 30,
                text: "We should discuss this matter ____ the team.",
                options: ["with", "to", "for", "among"],
                correctIndex: 0,
                tags: ["Preposition", "Collaboration"],
                analysis: {
                    A: "with - æ­£ç¢ºã€‚è¡¨ç¤ºèˆ‡...ä¸€èµ·è¨è«–",
                    B: "to - ä¸é©åˆæ­¤å¥å‹",
                    C: "for - è¡¨ç¤ºç‚ºäº†...",
                    D: "among - è¡¨ç¤ºåœ¨...ä¹‹ä¸­"
                }
            }
        ];

        // ===== å…¨å±€è®Šæ•¸ =====
        let userProfile = {};
        let quizHistory = [];
        let mistakeBook = [];
        let vocabulary = [];
        let currentQuizQueue = [];
        let currentQuestionIndex = 0;
        let quizStartTime = 0;
        let questionStartTime = 0;
        let currentFeedback = null;

        // ===== åˆå§‹åŒ– =====
        function init() {
            loadDataFromLocalStorage();
            setupEventListeners();
            showPage('onboardingPage');
        }

        // ===== äº‹ä»¶ç›£è½ =====
        function setupEventListeners() {
            document.getElementById('startLearningBtn').addEventListener('click', startLearning);
            document.getElementById('startQuizBtn').addEventListener('click', startQuiz);
            document.getElementById('nextQuestionBtn').addEventListener('click', nextQuestion);
            document.getElementById('saveWordBtn').addEventListener('click', saveWord);
            document.getElementById('backToDashboardBtn').addEventListener('click', () => {
                showPage('dashboardPage');
                updateDashboard();
            });
            document.getElementById('viewMistakesBtn').addEventListener('click', showMistakeBook);
            document.getElementById('viewVocabBtn').addEventListener('click', showWordBank);
            document.getElementById('settingsBtn').addEventListener('click', () => showPage('settingsPage'));
            document.getElementById('backFromMistakesBtn').addEventListener('click', () => showPage('dashboardPage'));
            document.getElementById('backFromVocabBtn').addEventListener('click', () => showPage('dashboardPage'));
            document.getElementById('backFromSettingsBtn').addEventListener('click', () => showPage('dashboardPage'));
            document.getElementById('exportCSVBtn').addEventListener('click', exportToCSV);
            document.getElementById('exportJSONBtn').addEventListener('click', exportToJSON);
            document.getElementById('importJSONBtn').addEventListener('click', () => document.getElementById('importFile').click());
            document.getElementById('importFile').addEventListener('change', importFromJSON);
            document.getElementById('resetBtn').addEventListener('click', resetAllData);
        }

        // ===== é é¢åˆ‡æ› =====
        function showPage(pageName) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageName).classList.add('active');
        }

        // ===== é–‹å§‹å­¸ç¿’ =====
        function startLearning() {
            const targetScore = document.getElementById('targetScore').value;
            const recentScore = document.getElementById('recentScore').value;
            const weakness = document.getElementById('weaknessFocus').value;

            if (!targetScore || !recentScore) {
                alert('è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½');
                return;
            }

            userProfile = {
                targetScore: parseInt(targetScore),
                recentScore: parseInt(recentScore),
                weakness: weakness,
                startDate: new Date().toISOString()
            };

            saveDataToLocalStorage();
            updateDashboard();
            showPage('dashboardPage');
        }

        // ===== æ›´æ–° Dashboard =====
        function updateDashboard() {
            const weaknessText = userProfile.weakness === 'All' ? 'å…¨æ–¹ä½' : tagTranslations[userProfile.weakness] || userProfile.weakness;
            document.getElementById('dashboardGreeting').textContent = `æ­¡è¿å›ä¾†ï¼Œå°ˆæ³¨æ–¼ ${weaknessText} è¨“ç·´ï¼`;
            document.getElementById('dashboardStats').textContent = `ç›®æ¨™åˆ†æ•¸ï¼š${userProfile.targetScore} | æœ€è¿‘æˆç¸¾ï¼š${userProfile.recentScore}`;

            if (quizHistory.length > 0) {
                const avgSpeed = (quizHistory.reduce((sum, q) => sum + q.timeTaken, 0) / quizHistory.length).toFixed(1);
                const correctCount = quizHistory.filter(q => q.isCorrect).length;
                const accuracy = ((correctCount / quizHistory.length) * 100).toFixed(1);
                document.getElementById('avgSpeed').textContent = avgSpeed;
                document.getElementById('correctRate').textContent = accuracy + '%';
            } else {
                document.getElementById('avgSpeed').textContent = '-';
                document.getElementById('correctRate').textContent = '-';
            }

            document.getElementById('completedQuizzes').textContent = Math.floor(quizHistory.length / 10);
            document.getElementById('mistakeCount').textContent = mistakeBook.length;
            document.getElementById('vocabCount').textContent = vocabulary.length;
        }

        // ===== é–‹å§‹æ¸¬é©— (å‹•æ…‹é¡Œåº«é‚è¼¯) =====
        function startQuiz() {
            currentQuizQueue = generateQuizQueue();
            currentQuestionIndex = 0;
            quizStartTime = Date.now();
            loadQuestion();
            showPage('quizPage');
        }

        // ===== ç”Ÿæˆæ¸¬é©—éšŠåˆ— (åŠ æ¬Šéš¨æ©Ÿ) =====
        function generateQuizQueue() {
            const queue = [];
            const weakness = userProfile.weakness;

            // å„ªå…ˆåŠ å…¥éŒ¯é¡Œæœ¬ä¸­çš„é¡Œç›® (æœ€å¤š 3 é¡Œ)
            const mistakeQuestions = mistakeBook.slice(0, 3);
            mistakeQuestions.forEach(mistake => {
                const question = questionsDatabase.find(q => q.id === mistake.questionId);
                if (question) queue.push(question);
            });

            // å¾å¼±é»é ˜åŸŸç¯©é¸é¡Œç›®
            let candidateQuestions = questionsDatabase.filter(q => {
                if (weakness === 'All') return true;
                return q.tags.includes(weakness);
            });

            // ç§»é™¤å·²åœ¨éšŠåˆ—ä¸­çš„é¡Œç›®
            candidateQuestions = candidateQuestions.filter(q => !queue.find(qq => qq.id === q.id));

            // éš¨æ©Ÿé¸æ“‡å¡«æ»¿åˆ° 10 é¡Œ
            while (queue.length < 10 && candidateQuestions.length > 0) {
                const randomIndex = Math.floor(Math.random() * candidateQuestions.length);
                queue.push(candidateQuestions[randomIndex]);
                candidateQuestions.splice(randomIndex, 1);
            }

            // å¦‚æœé¡Œç›®ä¸è¶³ï¼Œå¾å…¨éƒ¨é¡Œåº«è£œå……
            if (queue.length < 10) {
                let allQuestions = questionsDatabase.filter(q => !queue.find(qq => qq.id === q.id));
                while (queue.length < 10 && allQuestions.length > 0) {
                    const randomIndex = Math.floor(Math.random() * allQuestions.length);
                    queue.push(allQuestions[randomIndex]);
                    allQuestions.splice(randomIndex, 1);
                }
            }

            // æ‰“äº‚é †åº
            return queue.sort(() => Math.random() - 0.5);
        }

        // ===== è¼‰å…¥é¡Œç›® =====
        function loadQuestion() {
            if (currentQuestionIndex >= currentQuizQueue.length) {
                endQuiz();
                return;
            }

            const question = currentQuizQueue[currentQuestionIndex];
            questionStartTime = Date.now();

            document.getElementById('quizProgress').textContent = `ç¬¬ ${currentQuestionIndex + 1} / 10 é¡Œ`;
            document.getElementById('questionText').textContent = question.text;

            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            question.options.forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = option;
                btn.addEventListener('click', () => selectOption(index, question));
                optionsContainer.appendChild(btn);
            });

            document.getElementById('feedbackBox').classList.remove('show');
            document.getElementById('nextQuestionBtn').style.display = 'none';
            document.getElementById('saveWordBtn').style.display = 'none';
            startTimer();
        }

        // ===== è¨ˆæ™‚å™¨ =====
        function startTimer() {
            const timerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - questionStartTime) / 1000);
                document.getElementById('quizTimer').textContent = elapsed;
                if (elapsed > 60) clearInterval(timerInterval);
            }, 100);
        }

        // ===== é¸æ“‡é¸é … =====
        function selectOption(selectedIndex, question) {
            const timeTaken = Math.floor((Date.now() - questionStartTime) / 1000);
            const isCorrect = selectedIndex === question.correctIndex;
            const targetTime = question.tags.includes('Tense') || question.tags.includes('Conjunction') ? 10 : 30;
            const isTooSlow = timeTaken > targetTime;

            // è¨˜éŒ„ç­”é¡Œ
            const record = {
                questionId: question.id,
                text: question.text,
                userAnswer: question.options[selectedIndex],
                correctAnswer: question.options[question.correctIndex],
                timeTaken: timeTaken,
                isCorrect: isCorrect,
                tags: question.tags,
                timestamp: new Date().toISOString()
            };
            quizHistory.push(record);

            // å¦‚æœç­”éŒ¯ï¼ŒåŠ å…¥éŒ¯é¡Œæœ¬
            if (!isCorrect) {
                const mistakeRecord = {
                    questionId: question.id,
                    text: question.text,
                    userAnswer: question.options[selectedIndex],
                    correctAnswer: question.options[question.correctIndex],
                    tags: question.tags,
                    analysis: question.analysis,
                    timestamp: new Date().toISOString()
                };
                if (!mistakeBook.find(m => m.questionId === question.id)) {
                    mistakeBook.push(mistakeRecord);
                }
            }

            // é¡¯ç¤ºå›é¥‹
            showFeedback(isCorrect, isTooSlow, timeTaken, targetTime, question, selectedIndex);
            saveDataToLocalStorage();
        }

        // ===== é¡¯ç¤ºå›é¥‹ =====
        function showFeedback(isCorrect, isTooSlow, timeTaken, targetTime, question, selectedIndex) {
            const feedbackBox = document.getElementById('feedbackBox');
            const feedbackText = document.getElementById('feedbackText');
            const analysisBox = document.getElementById('analysisBox');

            let feedbackClass = '';
            let feedbackMessage = '';

            if (isCorrect && !isTooSlow) {
                feedbackClass = 'feedback-correct';
                feedbackMessage = `âœ“ å®Œç¾ï¼ (${timeTaken}ç§’)`;
            } else if (isCorrect && isTooSlow) {
                feedbackClass = 'feedback-slow';
                feedbackMessage = `âœ“ æ­£ç¢ºï¼Œä½†æœ‰é»æ…¢ (${timeTaken}ç§’ï¼Œç›®æ¨™ ${targetTime}ç§’)`;
            } else {
                feedbackClass = 'feedback-incorrect';
                feedbackMessage = `âœ— éŒ¯èª¤ (${timeTaken}ç§’)`;
            }

            feedbackBox.className = `feedback-box show ${feedbackClass}`;
            feedbackText.innerHTML = feedbackMessage;

            // é¡¯ç¤ºå…¨é¸é …åˆ†æ
            analysisBox.innerHTML = '';
            question.options.forEach((option, index) => {
                const analysisItem = document.createElement('div');
                analysisItem.className = 'analysis-item';
                const optionLabel = String.fromCharCode(65 + index); // A, B, C, D
                const isSelected = index === selectedIndex;
                const isCorrectOption = index === question.correctIndex;
                const analysis = question.analysis[optionLabel] || '';
                analysisItem.innerHTML = `<strong>${optionLabel}. ${option}</strong> ${isSelected ? '(æ‚¨çš„é¸æ“‡)' : ''} ${isCorrectOption ? '(æ­£ç¢ºç­”æ¡ˆ)' : ''}<br>${analysis}`;
                analysisBox.appendChild(analysisItem);
            });

            // é¡¯ç¤ºæ¨™ç±¤
            const tagsHtml = question.tags.map(tag => `<span class="tag">${tagTranslations[tag] || tag}</span>`).join('');
            analysisBox.innerHTML += `<div style="margin-top: 10px;">${tagsHtml}</div>`;

            document.getElementById('nextQuestionBtn').style.display = 'inline-block';
            document.getElementById('saveWordBtn').style.display = 'inline-block';
            currentFeedback = { question, selectedIndex, isCorrect };
        }

        // ===== ä¸‹ä¸€é¡Œ =====
        function nextQuestion() {
            currentQuestionIndex++;
            loadQuestion();
        }

        // ===== çµæŸæ¸¬é©— =====
        function endQuiz() {
            const correctCount = quizHistory.slice(-10).filter(q => q.isCorrect).length;
            const avgTime = (quizHistory.slice(-10).reduce((sum, q) => sum + q.timeTaken, 0) / 10).toFixed(1);
            const accuracy = ((correctCount / 10) * 100).toFixed(1);

            document.getElementById('finalScore').textContent = `${correctCount}/10`;
            document.getElementById('finalAvgTime').textContent = avgTime;
            document.getElementById('finalAccuracy').textContent = accuracy;

            saveDataToLocalStorage();
            showPage('resultsPage');
        }

        // ===== æ”¶è—å–®å­— =====
        function saveWord() {
            if (!currentFeedback || !currentFeedback.question) return;
            const word = currentFeedback.question.options[currentFeedback.question.correctIndex];
            if (!vocabulary.find(v => v.word === word)) {
                vocabulary.push({
                    word: word,
                    definition: `[${tagTranslations[currentFeedback.question.tags[0]] || currentFeedback.question.tags[0]}] ${currentFeedback.question.text}`,
                    timestamp: new Date().toISOString()
                });
                saveDataToLocalStorage();
                alert('å·²æ”¶è—ï¼');
            }
        }

        // ===== é¡¯ç¤ºéŒ¯é¡Œæœ¬ =====
        function showMistakeBook() {
            const container = document.getElementById('mistakeBookContainer');
            container.innerHTML = '';

            if (mistakeBook.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--apple-text-secondary);">ç›®å‰æ²’æœ‰éŒ¯é¡Œï¼Œç¹¼çºŒåŠ æ²¹ï¼</p>';
                showPage('mistakeBookPage');
                return;
            }

            // ç”Ÿæˆæ¨™ç±¤éæ¿¾å™¨
            const allTags = [...new Set(mistakeBook.flatMap(m => m.tags))];
            const tagFilter = document.getElementById('tagFilter');
            tagFilter.innerHTML = '';
            const allBtn = document.createElement('button');
            allBtn.textContent = 'å…¨éƒ¨';
            allBtn.className = 'active';
            allBtn.addEventListener('click', () => {
                document.querySelectorAll('#tagFilter button').forEach(b => b.classList.remove('active'));
                allBtn.classList.add('active');
                displayMistakes(mistakeBook);
            });
            tagFilter.appendChild(allBtn);

            allTags.forEach(tag => {
                const btn = document.createElement('button');
                btn.textContent = tagTranslations[tag] || tag;
                btn.addEventListener('click', () => {
                    document.querySelectorAll('#tagFilter button').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    const filtered = mistakeBook.filter(m => m.tags.includes(tag));
                    displayMistakes(filtered);
                });
                tagFilter.appendChild(btn);
            });

            displayMistakes(mistakeBook);
            showPage('mistakeBookPage');
        }

        // ===== é¡¯ç¤ºéŒ¯é¡Œ =====
        function displayMistakes(mistakes) {
            const container = document.getElementById('mistakeBookContainer');
            container.innerHTML = '';
            mistakes.forEach((mistake, index) => {
                const card = document.createElement('div');
                card.className = 'bento-card bento-card-large';
                const tagsHtml = mistake.tags.map(tag => `<span class="tag">${tagTranslations[tag] || tag}</span>`).join('');
                card.innerHTML = `
                    <h4>ç¬¬ ${index + 1} é¡Œ</h4>
                    <p style="margin: 10px 0;">${mistake.text}</p>
                    <div style="margin: 10px 0;">${tagsHtml}</div>
                    <p style="color: var(--apple-red);">æ‚¨çš„ç­”æ¡ˆï¼š${mistake.userAnswer}</p>
                    <p style="color: var(--apple-green);">æ­£ç¢ºç­”æ¡ˆï¼š${mistake.correctAnswer}</p>
                    <div class="analysis-section">
                        ${Object.entries(mistake.analysis).map(([key, value]) => `<div class="analysis-item"><strong>${key}.</strong> ${value}</div>`).join('')}
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // ===== é¡¯ç¤ºå–®å­—åº« =====
        function showWordBank() {
            const container = document.getElementById('wordBankContainer');
            container.innerHTML = '';

            if (vocabulary.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--apple-text-secondary); width: 100%;">ç›®å‰æ²’æœ‰æ”¶è—å–®å­—ï¼Œåœ¨æ¸¬é©—ä¸­é»æ“Šã€Œæ”¶è—å–®å­—ã€ä¾†æ–°å¢ï¼</p>';
                showPage('wordBankPage');
                return;
            }

            vocabulary.forEach((word, index) => {
                const card = document.createElement('div');
                card.className = 'flip-card';
                card.innerHTML = `
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                            <div>${word.word}</div>
                        </div>
                        <div class="flip-card-back">
                            <div>${word.definition}</div>
                        </div>
                    </div>
                `;
                card.addEventListener('click', () => card.classList.toggle('flipped'));
                container.appendChild(card);
            });

            showPage('wordBankPage');
        }

        // ===== CSV åŒ¯å‡º =====
        function exportToCSV() {
            const BOM = '\uFEFF';
            let csv = BOM + 'æ—¥æœŸ,é¡Œç›®,æ­£ç¢ºç­”æ¡ˆ,æ‚¨çš„ç­”æ¡ˆ,ç”¨æ™‚(ç§’),çµæœ\n';
            quizHistory.forEach(record => {
                const result = record.isCorrect ? 'æ­£ç¢º' : 'éŒ¯èª¤';
                csv += `"${record.timestamp}","${record.text}","${record.correctAnswer}","${record.userAnswer}",${record.timeTaken},"${result}"\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'TOEIC_Speed_Coach_Data.csv';
            link.click();
        }

        // ===== JSON åŒ¯å‡º =====
        function exportToJSON() {
            const data = {
                userProfile,
                quizHistory,
                mistakeBook,
                vocabulary,
                exportDate: new Date().toISOString()
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'TOEIC_Speed_Coach_Backup.json';
            link.click();
        }

        // ===== JSON åŒ¯å…¥ =====
        function importFromJSON(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    userProfile = data.userProfile || {};
                    quizHistory = data.quizHistory || [];
                    mistakeBook = data.mistakeBook || [];
                    vocabulary = data.vocabulary || [];
                    saveDataToLocalStorage();
                    alert('è³‡æ–™åŒ¯å…¥æˆåŠŸï¼');
                    updateDashboard();
                } catch (error) {
                    alert('åŒ¯å…¥å¤±æ•—ï¼š' + error.message);
                }
            };
            reader.readAsText(file);
        }

        // ===== é‡ç½®æ‰€æœ‰è³‡æ–™ =====
        function resetAllData() {
            if (confirm('ç¢ºå®šè¦é‡ç½®æ‰€æœ‰è³‡æ–™å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•æ’¤éŠ·ã€‚')) {
                userProfile = {};
                quizHistory = [];
                mistakeBook = [];
                vocabulary = [];
                localStorage.removeItem('toeicCoachData');
                alert('å·²é‡ç½®æ‰€æœ‰è³‡æ–™');
                showPage('onboardingPage');
            }
        }

        // ===== localStorage æ“ä½œ =====
        function saveDataToLocalStorage() {
            const data = {
                userProfile,
                quizHistory,
                mistakeBook,
                vocabulary
            };
            localStorage.setItem('toeicCoachData', JSON.stringify(data));
        }

        function loadDataFromLocalStorage() {
            const data = localStorage.getItem('toeicCoachData');
            if (data) {
                const parsed = JSON.parse(data);
                userProfile = parsed.userProfile || {};
                quizHistory = parsed.quizHistory || [];
                mistakeBook = parsed.mistakeBook || [];
                vocabulary = parsed.vocabulary || [];
            }
        }

        // ===== å•Ÿå‹•æ‡‰ç”¨ =====
        init();
    </script>
</body>
</html>
